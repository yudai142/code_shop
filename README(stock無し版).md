># **code_shop**
制作するECサイトは、予め管理ページで商品を追加してから、商品を購入するサイトになります。
購入までの流れは以下になります（ページの説明については下述を参照してください）。
- 「商品管理ページ」で、 販売する商品を追加する。  
- 「ユーザ登録ページ」で、ユーザを登録する。  
- 「ログインページ」で、登録ユーザでログインする。  
- 「商品一覧ページ」で、購入する商品を選択する。  
- 「ショッピングカートページ」で、購入予定の商品数を変更など行い、購入を実行する。  
- 「購入完了ページ」で、購入した商品情報を表示する。  
# サイト概要マップ
## 【販売を管理側】
### 「商品管理ページ」  
- 販売する商品情報の追加、変更、削除を行う  
  
### 「ユーザ管理ページ」  
- 登録ユーザの一覧表示する  
  
## 【商品を購入するユーザ側】
### 「ユーザ登録ページ」  
- ユーザを登録する  
  
### 「ログインページ」  
- 登録ユーザでログインする  
  
### 「商品一覧ページ」  
- 販売する商品をユーザに表示する  
- ショッピングカートページに遷移する  
  
### 「ショッピングカートページ」  
- 購入予定の商品を表示する  
- 購入予定の商品を削除する  
- 購入予定の商品数を変更する  
- 商品を購入する  
  
### 「購入完了ページ」  
- 購入した商品情報を表示する。  

# ページ詳細

## 全ページ共通
- 非ログイン時はログインページに遷移される。
- ヘッダーのcode_shopのロゴをクリックすると、商品一覧ページにアクセスする
- ヘッダーのログアウトボタンでログアウトができる
- ヘッダーのカートアイコンをクリックするとショッピングカートページにアクセスできる
---
### 追加要素
- adminユーザーでログインしている場合はヘッダーにタブが追加され、クリックするとサイドバーが出現し、商品管理ページ、商品登録ページ、ユーザー管理ページのリンクにアクセスできる
---
<br><br>

## 商品管理ページ(sell_list.php)
- ログインしているユーザーが追加した商品の一覧情報として、「商品画像」、「商品名」、「値段」、「在庫数」、「公開ステータス」のデータを一覧で表示する
- 一覧から指定商品の在庫数の変更ができる
- 商品一覧から指定商品の公開ステータス（「公開(1)」あるいは「非公開(0)」）を変更できる。
- 商品一覧から指定商品を削除できる。
- 商品一覧から在庫数を変更する場合、0以上の整数のみ可能とする。0以上の整数以外はエラーメッセージを表示して、変更できない。
- ヘッダーのタブからユーザ管理ページに遷移できる。
- ヘッダーのタブからログアウトできる。ログアウトした場合はログインページに遷移する。
- ログインしていない状態で当画面にアクセスした場合、当画面を表示せずに「ログインページ」に遷移する。  
<br><br>

## ユーザ管理ページ(user_list.php)
- 登録したユーザの一覧情報として、「ユーザ名」、「登録日時」のデータを一覧で表示する。
- ヘッダーのタブから商品管理ページに遷移できる。
- ヘッダーのタブからログアウトできる。ログアウトした場合はログインページに遷移する。
- ログインしていない状態で当画面にアクセスした場合、当画面を表示せずに「ログインページ」に遷移する。
<br><br>

# ↓追加したページ↓

## 商品登録ページ(new_item.php)
- 「商品名」「値段」「在庫数」「公開ステータス」「商品画像」を入力し、商品を追加できる。
- 商品の追加あるいは指定商品の情報（「在庫数」、「公開ステータス」）の変更が正常に完了した場合、完了のメッセージを表示する。
- 商品を追加する場合、「商品名」「値段」、「在庫数」、「公開ステータス」「商品画像」のいずれかを指定していない場合、エラーメッセージを表示して、商品を追加できない。
- 商品を追加する場合、「値段」、「在庫数」は0以上の整数のみ可能とする。0以上の整数以外はエラーメッセージを表示して、商品を追加できない。
- 商品を追加する場合、公開ステータスは「公開」あるいは「非公開」のみ可能とする。「公開」あるいは「非公開」以外はエラーメッセージを表示して、商品を追加できない。
- アップロードできる「商品画像」のファイル形式は「JPEG」、「PNG」のみ可能とする。「JPEG」、「PNG」以外はエラーメッセージを表示して、商品を追加できない。
---
<br><br>

## ユーザ登録ページ(sign_up.php)
- ユーザ名」「パスワード」を入力する項目を表示する。
- 登録」ボタンをクリックした場合、入力した「ユーザ名」「パスワード」をデータベースに保存後、ログインページに遷移し、登録完了のメッセージを表示する。
- ユーザ情報を追加する場合、「ユーザ名」「パスワード」は、「使用可能文字は半角英数字」かつ「文字数は6文字以上」のみを可能とする。それ以外の場合に「登録」ボタンをクリックした場合、エラーメッセージを表示して、ユーザ情報を追加できない。
- ユーザ情報を追加する場合、既に同じ「ユーザ名」が登録されている場合、エラーメッセージを表示して、ユーザ情報を追加できない。(code_shopテーブルのuser_nameカラムにuniqueキーを付与)
- ログインページに遷移できる。
<br><br>

## ログインページ(login.php)
- 「ユーザ名」「パスワード」を入力する項目を表示する。
- 「ログイン」ボタンをクリックした場合、「ユーザ名」と「パスワード」が登録されているユーザ情報と一致したとき、「商品一覧ページ」に遷移する。
- もし管理用ユーザ（ID:admin ,パスワード:admin）でログインした場合、管理側の商品管理ページに遷移する。
- 「ログイン」ボタンをクリックした場合、「ユーザ名」と「パスワード」が登録されているユーザ情報と一致しないとき、エラーメッセージを表示して、ログインすることができない。
- ヘッダーのタブからユーザ登録ページに遷移できる。
<br><br>

## 商品一覧ページ(index.php)
- 商品のステータスが「公開」の商品情報（「商品名」「値段」「画像」）を一覧で表示する。
- 商品の在庫が0の場合、「カートに入れる」ボタンは表示せず、「売り切れ」を表示する。
- 「カートに入れる」ボタンをクリックした場合、既に指定商品がカートに追加されているとき、指定商品のカートの数量を＋１に変更する（カート情報はデータベースの値を更新する）。
- ログインしていない状態で当画面にアクセスした場合、当画面を表示せずに「ログインページ」に遷移する。
- ヘッダーのタブからログアウトできる。ログアウトした場合はログインページに遷移する。
<br>
<追加要素>
- 商品カードをクリックするとその商品の詳細ページに遷移する
<br><br>

## ショッピングカートページ(cart.php)
- ショッピングカートに入れた対象の商品情報（「画像」「商品名」「値段」「数量」）を表示する（カート情報はデータベースから参照する）。
- ショッピングカートにある商品の合計を表示する。
- 指定の商品を削除することができる（カート情報はデータベースの値を更新する）。
- 指定の商品を数量を変更することができる（カート情報はデータベースの値を更新する）。
- 商品を購入する（「購入完了ページ」に遷移する）。
- カート一覧から購入予定の商品数を変更する場合、正の整数のみ可能とする(0は含まない)。正の整数以外はエラーメッセージを表示して、変更できない。
- 商品一覧ページに遷移できる（例、ロゴアイコンをクリックすると遷移）。
- ログインしていない状態で当画面にアクセスした場合、当画面を表示せずに「ログインページ」に遷移する。
- ログアウトできる。ログアウトした場合はログインページに遷移する。
<br><br>

## 購入完了ページ(finish.php)
- 購入した商品情報（「画像」「商品名」「値段」「数量」）を表示する。
- 商品の合計を表示する。
- 購入商品の在庫数を、購入数に応じて減らす。
- ショッピングカートに入れた対象の商品情報を削除する（データベースを更新する）
- 商品一覧ページに遷移できる。
- ログインしていない状態で当画面にアクセスした場合、当画面を表示せずに「ログインページ」に遷移する。
- ヘッダーのタブからログアウトできる。ログアウトした場合はログインページに遷移する。
<br><br>


# DB設計

## itemsテーブル
|カラム名|カラム名(日本語)|型|オプション|
|-|-|-----|-------|
|id|商品ID|bigInteger|primary key, not null, <br>auto increment|
|name|商品名|varchar|not null, unsigned|
|price|価格|integer|not null, unsigned|
|image|商品画像ファイル名|varchar||
|status|公開フラグ(1:公開, 0:非公開)|tinyInteger|not null, unsigned|
|created_date|登録日時|datetime|not null|
|updated_date|更新日時|timestamps|not null|
<br>

### インデックス
|名前|カラム名|参照テーブル|参照カラム|削除時|
|-|-|-|-|-|
|items_user_id_foreign |user_id|users|id|cascade|
<br>

## stocksテーブル
|カラム名|カラム名(日本語)|型|オプション|
|-|-|-----|-------|
|id|在庫ID|bigInteger|primary key, not null, <br>auto increment|
|item_id|商品ID|bigInteger|not null, unsigned|
|stock|在庫数|integer|not null, unsigned, default(0)|
|created_date|登録日時|datetime|not null|
|updated_date|更新日時|timestamps|not null|
<br>

### インデックス
|名前|カラム名|参照テーブル|参照カラム|削除時|
|-|-|-|-|-|
|stocks_item_id_foreign |item_id|items|id|cascade|
<br>

## cartsテーブル
|カラム名|カラム名(日本語)|型|オプション|
|-|-|-----|-------|
|id|カートID|bigInteger|primary key, not null, <br>auto increment|
|user_id|ユーザーID|bigInteger|not null, unsigned|
|item_id|商品ID|bigInteger|not null, unsigned|
|amount|購入予定商品数|integer|not null, unsigned, default(1)|
|created_date|登録日時|datetime|not null|
|updated_date|更新日時|timestamps|not null|
<br>

### インデックス
|名前|カラム名|参照テーブル|参照カラム|削除時|
|-|-|-|-|-|
|carts_user_id_foreign |user_id|users|id|cascade|
|carts_item_id_foreign |item_id|items|id|cascade|
<br>

## usersテーブル
|カラム名|カラム名(日本語)|型|オプション|
|-|-|-----|-------|
|id|ユーザーID|bigInteger|primary key, not null, <br>auto increment|
|user_name|ユーザー名|varchar|not null, unique|
|password|パスワード|varchar|not null|
|created_date|登録日時|datetime|not null|
|updated_date|更新日時|timestamps|not null|
<br>